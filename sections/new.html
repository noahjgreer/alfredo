<!DOCTYPE html>
<html>
    <head>
        <meta name="theme-color" content="#F2F2F6">
    </head>
    <body style="background-color: #F2F2F6;">
        <div class="section-header">
            <div class="content">
                <h1>New</h1>
                <!-- <a class="profile">
                    <img src="/assets/icons/user-default.svg" alt="Your Profile">
                </a> -->
            </div>
            <!-- <div class="line"></div> -->
        </div>
        <div class="seg-control focus">
            <a class="seg-control-item" onclick="updateSegmentedControl('updateActive', this)">
                Task
            </a>
            <a class="seg-control-item" onclick="updateSegmentedControl('updateActive', this)">
                List
            </a>
            <a class="seg-control-item" onclick="updateSegmentedControl('updateActive', this)">
                Integration
            </a>
        </div>
        <div class="grouped list">
            <h3>Task Information</h3>
            <ul>
                <li class="dropdown">
                    <p class="label" id="type">
                        Task Type
                    </p>
                    <p class="value" id="type">
                        Task
                        <img src="/assets/icons/arrow-double.svg" alt="" class="icon">
                    </p>
                    <select name="type" id="type">
                        <option value="task" selected>Task</option>
                        <option value="routine">Routine</option>
                        <option value="event">Event</option>
                    </select>
                </li>
            </ul>
        </div>
        <div class="grouped list">
            <ul>
                <li>
                    <input class="value" id="name" placeholder="Title"></input>
                </li>
                <li class="dropdown">
                    <p class="label" id="list">
                        List
                    </p>
                    <p class="value" id="list">
                        <img src="/assets/icons/wheel2.svg" alt="Loading Lists..." class="loading-wheel">
                    </p>
                    <select name="list" id="list">
                        <option value="Task">Task</option>
                        <option value="Routine">Routine</option>
                        <option value="Event">Event</option>
                    </select>
                </li>
            </ul>
        </div>
        <button type="button" onclick="createNew({
            'name': document.querySelector('#name.value').value,
            'type': document.querySelector('select#type').value,
            'list': document.querySelector('select#list').value
        }, {
            'caller': this
        })" class="attention-button inline" id="new-task-button">
            <p>Create New Task</p>
        </button>
    </body>
    <script>
        updateSegmentedControl('init');

        // Listen to Dropdown value update, and then set the innerText value to be the selected option
        document.querySelectorAll('select').forEach(item => {
            item.addEventListener('change', event => {
                console.log(event);
                item.parentElement.querySelector('.value').innerHTML = document.querySelector(`option[value=${event.target.value}]`).innerText + `
                <img src="/assets/icons/arrow-double.svg" alt="" class="icon">
                `;
            })
        })

        // Get the lists from the server
        async function setTaskListsDropdown() {
            var taskLists = await fetchFromCategory('tasks', undefined, undefined, true, true);
            var listDropdowns = document.querySelector('select#list');
            console.log(listDropdowns);
            console.log(taskLists);
            listDropdowns.innerHTML = '';
            taskLists.forEach(list => {
                var option = document.createElement('option');
                if (list.id != 'all' && list.id != 'completed') {
                    option.value = list.id;
                    option.innerText = list.name;
                    listDropdowns.appendChild(option);
                }
            });
            listDropdowns.firstChild.selected = true;

            // Update the dropdown value
            listDropdowns.parentElement.querySelector('.value').innerHTML = `
            ${listDropdowns.firstChild.innerText}
            <img src="/assets/icons/arrow-double.svg" alt="" class="icon">
            `;
        }
        
        setTaskListsDropdown();
    </script>
</html>